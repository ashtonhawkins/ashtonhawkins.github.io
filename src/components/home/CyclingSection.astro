---
import SectionHeader from '@components/ui/SectionHeader.astro';
import cycling from '@data/cycling.json';
import RouteTrace from '@components/home/RouteTrace.astro';
import CyclingGauges from '@components/home/CyclingGauges.astro';

const spark = (arr: number[]) => {
  const min = Math.min(...arr);
  const max = Math.max(...arr);
  return arr.map((v, i) => {
    const x = (i / (arr.length - 1)) * 80;
    const y = 24 - ((v - min) / (max - min || 1)) * 20 - 2;
    return `${x},${y}`;
  }).join(' ');
};
---

<section id="cycling" class="cycling">
  <SectionHeader label="Cycling" />
  <div class="cycling__grid">
    <RouteTrace path={cycling.lastRouteTrace} stats={`${cycling.lastRide.miles} MI / ${cycling.lastRide.elevation.toLocaleString()} FT / ${cycling.lastRide.duration}`} />
    <CyclingGauges miles={cycling.thisMonth.miles} elevation={cycling.thisMonth.elevation} rides={cycling.thisMonth.rides} goals={cycling.goals} />
    <div class="cycling__panel cycling__panel--stats">
      <div class="cycling__sparkline-group">
        <div class="cycling__sparkline-label">WEEKLY MI</div>
        <svg class="cycling__sparkline" viewBox="0 0 80 24"><polyline points={spark(cycling.weeklyMiles)} /></svg>
      </div>
      <div class="cycling__sparkline-group">
        <div class="cycling__sparkline-label">WEEKLY ELEV</div>
        <svg class="cycling__sparkline" viewBox="0 0 80 24"><polyline points={spark(cycling.weeklyElevation)} /></svg>
      </div>
      <div class="cycling__ytd"><span class="cycling__ytd-value">YTD: {cycling.ytd.miles} MI</span></div>
    </div>
  </div>
</section>

<style>
  .cycling__grid { display:grid; gap:1rem; }
  .cycling__panel { border:1px solid var(--border); padding:1rem; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:.75rem; }
  .cycling__panel--stats { align-items:flex-start; font:.72rem 'IBM Plex Mono',monospace; text-transform:uppercase; letter-spacing:.08em; color:var(--text-secondary); }
  .cycling__sparkline-group { width:100%; }
  .cycling__sparkline-label { margin:.35rem 0; }
  .cycling__sparkline{width:80px;height:24px;display:block;margin:.2rem 0 .6rem}
  .cycling__sparkline polyline{fill:none;stroke:var(--accent-primary);stroke-width:1}
  .cycling__ytd { border-top:1px solid var(--border); padding-top:.75rem; width:100%; }
  .cycling__ytd-value { font-family:'IBM Plex Mono', monospace; font-size:16px; font-weight:700; color:var(--text-primary); }
  @media (width >= 64rem) { .cycling__grid { grid-template-columns: 1fr 1.4fr 1fr; align-items:stretch; } }
  @media (max-width: 768px) { .cycling__grid { grid-template-columns: 1fr; } }
</style>
