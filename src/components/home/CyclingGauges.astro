---
interface Props { miles: number; elevation: number; rides: number; goals: { monthlyMiles: number; monthlyElevation: number }; }
const { miles, elevation, rides, goals } = Astro.props;
const pctMiles = Math.min(1, miles / goals.monthlyMiles);
const pctElev = Math.min(1, elevation / goals.monthlyElevation);
---
<div class="gauges" data-gauge-wrap>
  <div class="gauges__row">
    <div class="gauge" data-gauge data-value={pctMiles}><svg viewBox="0 0 120 80"><path d="M10 70 A50 50 0 0 1 110 70" class="bg"/><path d="M10 70 A50 50 0 0 1 110 70" class="fg"/></svg><strong>{miles}</strong><span>MI THIS MONTH</span></div>
    <div class="gauge" data-gauge data-value={pctElev}><svg viewBox="0 0 120 80"><path d="M10 70 A50 50 0 0 1 110 70" class="bg"/><path d="M10 70 A50 50 0 0 1 110 70" class="fg"/></svg><strong>{elevation.toLocaleString()}</strong><span>FT GAINED</span></div>
  </div>
  <div class="rides"><strong>{rides}</strong><div class="bar"><i data-rides-fill style="width:0%"></i></div><span>RIDES</span></div>
</div>
<style>
.gauges{border:1px solid var(--border);padding:1rem;display:grid;gap:.8rem}
.gauges__row{display:grid;grid-template-columns:1fr 1fr;gap:.7rem}
.gauge,.rides{text-align:center;font-family:'IBM Plex Mono',monospace}
.gauge svg{width:100px;height:66px}
.bg{fill:none;stroke:color-mix(in srgb,var(--border) 30%, transparent);stroke-width:6}.fg{fill:none;stroke:var(--accent-primary);stroke-width:6;stroke-linecap:round;stroke-dasharray:158;stroke-dashoffset:158}
strong{display:block;font-size:1.05rem}span{font-size:.62rem;letter-spacing:.08em;color:var(--text-secondary)} .bar{height:4px;background:var(--border);margin:.4rem 0}.bar i{display:block;height:100%;background:var(--accent-primary)}
</style>
<script>
// @ts-nocheck
const wraps=document.querySelectorAll('[data-gauge-wrap]'); wraps.forEach((wrap)=>{if(!(wrap instanceof HTMLElement))return; const reduced=window.matchMedia('(prefers-reduced-motion: reduce)').matches; const run=()=>{if(wrap.classList.contains('animated')) return; wrap.classList.add('animated'); wrap.querySelectorAll('[data-gauge]').forEach((node)=>{if(!(node instanceof HTMLElement))return; const path=node.querySelector('.fg'); if(!(path instanceof SVGPathElement))return; const value=Number(node.dataset.value??0); const total=158; path.style.strokeDashoffset=`${total*(1-value)}`; if(!reduced) path.animate([{strokeDashoffset:total},{strokeDashoffset:total*(1-value)}],{duration:1500,easing:'ease-out',fill:'forwards'});}); const fill=wrap.querySelector('[data-rides-fill]'); if(fill instanceof HTMLElement){fill.style.width='70%';}};
const ob=new IntersectionObserver((entries)=>entries.forEach((e)=>{if(e.isIntersecting)run()}),{threshold:.5}); ob.observe(wrap);});
</script>
