---
interface Props { miles: number; elevation: number; rides: number; goals: { monthlyMiles: number; monthlyElevation: number }; }
const { miles, elevation, rides, goals } = Astro.props;
const pctMiles = Math.min(1, miles / goals.monthlyMiles);
const pctElev = Math.min(1, elevation / goals.monthlyElevation);
const ridesPct = Math.min(1, rides / 15);
---
<div class="cycling__panel cycling__panel--gauges" data-gauge-wrap>
  <div class="cycling__gauge-row">
    <div class="cycling__gauge" data-gauge data-value={pctMiles}>
      <svg viewBox="0 0 120 80" aria-hidden="true"><path d="M10 70 A50 50 0 0 1 110 70" class="bg"/><path d="M10 70 A50 50 0 0 1 110 70" class="fg"/></svg>
      <div class="cycling__gauge-value">{miles}</div>
      <div class="cycling__gauge-label">MI THIS MONTH</div>
    </div>
    <div class="cycling__gauge" data-gauge data-value={pctElev}>
      <svg viewBox="0 0 120 80" aria-hidden="true"><path d="M10 70 A50 50 0 0 1 110 70" class="bg"/><path d="M10 70 A50 50 0 0 1 110 70" class="fg"/></svg>
      <div class="cycling__gauge-value">{elevation.toLocaleString()}</div>
      <div class="cycling__gauge-label">FT GAINED</div>
    </div>
  </div>
  <div class="cycling__rides-bar">
    <div class="cycling__rides-value">{rides}</div>
    <div class="cycling__rides-label">RIDES</div>
    <div class="cycling__rides-track"><i data-rides-fill style={`width:${Math.round(ridesPct * 100)}%`}></i></div>
  </div>
</div>
<style>
.cycling__panel--gauges{border:1px solid var(--border);padding:1rem;display:grid;gap:.85rem}
.cycling__gauge-row{display:flex;gap:1rem;justify-content:center}
.cycling__gauge{text-align:center;font-family:'IBM Plex Mono',monospace}
.cycling__gauge svg{width:80px;height:54px}
.bg{fill:none;stroke:color-mix(in srgb,var(--border) 30%, transparent);stroke-width:6}
.fg{fill:none;stroke:var(--accent-primary);stroke-width:6;stroke-linecap:round;stroke-dasharray:158;stroke-dashoffset:158}
.cycling__gauge-value{font-family:'IBM Plex Mono',monospace;font-size:18px;font-weight:700;color:var(--text-primary)}
.cycling__gauge-label,.cycling__rides-label{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:.08em}
.cycling__rides-bar{text-align:center;font-family:'IBM Plex Mono',monospace;width:100%}
.cycling__rides-value{font-size:1.05rem;font-weight:700;color:var(--text-primary)}
.cycling__rides-track{height:4px;background:var(--border);margin:.4rem 0}
.cycling__rides-track i{display:block;height:100%;background:var(--accent-primary)}
</style>
<script>
// @ts-nocheck
const wraps=document.querySelectorAll('[data-gauge-wrap]'); wraps.forEach((wrap)=>{if(!(wrap instanceof HTMLElement))return; const reduced=window.matchMedia('(prefers-reduced-motion: reduce)').matches; const run=()=>{if(wrap.classList.contains('animated')) return; wrap.classList.add('animated'); wrap.querySelectorAll('[data-gauge]').forEach((node)=>{if(!(node instanceof HTMLElement))return; const path=node.querySelector('.fg'); if(!(path instanceof SVGPathElement))return; const value=Number(node.dataset.value??0); const total=158; path.style.strokeDashoffset=`${total*(1-value)}`; if(!reduced) path.animate([{strokeDashoffset:total},{strokeDashoffset:total*(1-value)}],{duration:1500,easing:'ease-out',fill:'forwards'});});};
const ob=new IntersectionObserver((entries)=>entries.forEach((e)=>{if(e.isIntersecting)run()}),{threshold:.5}); ob.observe(wrap);});
</script>
