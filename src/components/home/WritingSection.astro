---
import SectionHeader from '@components/ui/SectionHeader.astro';
import WritingDrift from '@components/home/WritingDrift.astro';
import feeds from '@data/feeds-cache.json';

const posts = ((feeds as any)?.items?.x ?? []).slice(0, 5);
---

<section class="writing-section">
  <SectionHeader label="Writing" />
  <div class="writing-layout">
    <WritingDrift />
    <aside class="x-sidebar">
      <h3>// X <span aria-hidden="true">✕</span></h3>
      <ul>
        {posts.length ? posts.map((post: any) => (
          <li>
            <p>{String(post.text ?? post.title ?? 'No text').slice(0, 140)}</p>
            <span>{post.relativeTime ?? post.timeAgo ?? '—'}</span>
          </li>
        )) : <li><p>No recent posts cached.</p><span>offline</span></li>}
      </ul>
      <a href="https://x.com/" target="_blank" rel="noreferrer">@handle →</a>
    </aside>
  </div>
  <p class="writing__footer"><a href="/writing">VIEW ALL POSTS →</a></p>
</section>

<style>
  .writing-layout { display:grid; gap:1rem; }
  .x-sidebar { border:1px solid var(--border); padding:.8rem; background:var(--surface-primary); }
  .x-sidebar h3 { margin:0 0 .6rem; font:700 .76rem 'IBM Plex Mono', monospace; letter-spacing:.08em; }
  .x-sidebar ul { list-style:none; margin:0; padding:0; }
  .x-sidebar li { padding:.55rem 0; border-bottom:1px solid color-mix(in srgb, var(--border) 70%, transparent); }
  .x-sidebar p { margin:0; font:.74rem/1.35 'IBM Plex Sans',sans-serif; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
  .x-sidebar span { font:.68rem 'IBM Plex Mono',monospace; color:var(--text-secondary); text-transform:uppercase; }
  .x-sidebar a,.writing__footer a { text-decoration:none; font:.72rem 'IBM Plex Mono',monospace; color:var(--text-secondary); letter-spacing:.08em; }
  .x-sidebar a:hover,.writing__footer a:hover{color:var(--accent-primary);} .writing__footer{margin:.65rem 0 0;}
  @media (width >= 60rem) { .writing-layout { grid-template-columns: minmax(0, 1.65fr) minmax(0, 1fr); align-items:start; } }
</style>
