---
import landmarks from '@data/travel-landmarks.json';
const map = landmarks as Record<string, { landmark: string; path: string }>;
---
<div class="travel-bg" data-travel-bg data-landmarks={JSON.stringify(map)}>
  <canvas data-travel-grid></canvas>
  <svg viewBox="0 0 200 200" class="travel-landmark" data-travel-landmark aria-hidden="true"><path d="" data-landmark-path></path></svg>
</div>
<style>
.travel-bg{position:absolute;inset:0}.travel-bg canvas,.travel-landmark{position:absolute;inset:0;width:100%;height:100%}
.travel-landmark{left:auto;right:4%;width:34%;height:78%}
.travel-landmark path{fill:none;stroke:color-mix(in srgb,var(--accent-primary) 35%, transparent);stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
</style>
<script>
// @ts-nocheck
const bg=document.querySelector('[data-travel-bg]'); const canvas=document.querySelector('[data-travel-grid]'); const pathEl=document.querySelector('[data-landmark-path]');
if(bg instanceof HTMLElement && canvas instanceof HTMLCanvasElement && pathEl instanceof SVGPathElement){const ctx=canvas.getContext('2d'); if(ctx){const landmarks=JSON.parse(bg.dataset.landmarks??'{}'); let w=0,h=0,seed=1,city='Tokyo';
const rand=()=>{seed=(seed*1664525+1013904223)%4294967296; return seed/4294967296};
const resize=()=>{const r=canvas.getBoundingClientRect(); w=r.width; h=r.height; const dpr=window.devicePixelRatio||1; canvas.width=w*dpr; canvas.height=h*dpr; ctx.setTransform(dpr,0,0,dpr,0,0)};
const draw=()=>{ctx.clearRect(0,0,w,h); ctx.strokeStyle='color-mix(in srgb,var(--text-tertiary) 12%, transparent)';
  const hLines=8+Math.floor(rand()*5); const vLines=6+Math.floor(rand()*5);
  for(let i=0;i<hLines;i++){const y=(i+1)/(hLines+1)*h + (rand()-0.5)*14; ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y+(rand()-0.5)*8); ctx.lineWidth=i%3===0?1:0.5; ctx.stroke();}
  for(let i=0;i<vLines;i++){const x=(i+1)/(vLines+1)*w + (rand()-0.5)*16; ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x+(rand()-0.5)*10,h); ctx.lineWidth=i%3===0?1:0.5; ctx.stroke();}
};
const setCity=(next)=>{city=next; seed=[...city].reduce((a,c)=>a+c.charCodeAt(0),1); resize(); draw(); const lm=landmarks[city]; pathEl.setAttribute('d',lm?.path ?? 'M60,190 L140,190'); const len=pathEl.getTotalLength(); pathEl.style.strokeDasharray=`${len}`; pathEl.style.strokeDashoffset=`${len}`; pathEl.animate([{strokeDashoffset:len,opacity:.4},{strokeDashoffset:0,opacity:1}],{duration:3600,easing:'ease-out',fill:'forwards'})};
bg.addEventListener('travel-city-change',(e)=>setCity(e.detail.city)); setCity('Tokyo'); window.addEventListener('resize',()=>setCity(city));
}}
</script>
