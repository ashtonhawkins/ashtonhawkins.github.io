---
import SectionHeader from '@components/ui/SectionHeader.astro';
import NoiseTexture from '@components/ui/NoiseTexture.astro';
import StatusChip from '@components/ui/StatusChip.astro';
import TravelCardBackground from '@components/home/TravelCardBackground.astro';
import travelData from '@data/travel.json';
import superlativesData from '@data/travel-superlatives.json';
---

<section class="travel" data-travel data-cities={JSON.stringify(travelData)}>
  <SectionHeader label="Travel" />
  <p class="travel__strip">{travelData.map((entry, index) => <><span>{entry.place.toUpperCase()} ×{entry.visits}</span>{index < travelData.length - 1 && <span class="sep">·</span>}</>)}</p>

  <article class="travel-card" data-travel-card>
    <TravelCardBackground />
    <NoiseTexture opacity={0.03} />
    <div class="travel-card__content" data-travel-content>
      <h3 data-travel-city>{travelData[0].place}</h3>
      <p class="country" data-travel-country>{travelData[0].country}</p>
      <StatusChip label={`×${travelData[0].visits}`} active />
      <p class="route" data-travel-route>{travelData[0].routes?.[0] ?? 'SFO → ---'}</p>
    </div>
  </article>

  <ul class="travel__supers">{superlativesData.superlatives.slice(0, 2).map((item) => <li><a href="/travel">{item.category.toUpperCase()} {superlativesData.year}: {item.value} — {item.place}</a></li>)}</ul>
</section>

<style>
  .travel__strip,.travel__supers{font:.72rem 'IBM Plex Mono',monospace;text-transform:uppercase;letter-spacing:.08em;color:var(--text-secondary)}
  .travel__strip{display:flex;flex-wrap:wrap;gap:.45rem;margin:0 0 1rem}.sep{color:var(--text-tertiary)}
  .travel-card{position:relative;min-height:220px;border:1px solid var(--border);overflow:hidden;margin-bottom:1rem;background:var(--surface-primary)}
  .travel-card__content{position:relative;z-index:3;padding:1rem;display:grid;gap:.4rem;max-width:260px;transition:opacity .3s ease}
  .travel-card__content.is-fading{opacity:0}
  .travel-card h3{margin:0;font:700 1.25rem 'Space Grotesk Variable',sans-serif;letter-spacing:.06em;text-transform:uppercase}
  .country,.route{margin:0;font:.72rem 'IBM Plex Mono',monospace;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.08em}
  .travel__supers{list-style:none;margin:0;padding:0;display:grid;gap:.4rem}.travel__supers a{color:inherit;text-decoration:none}.travel__supers a:hover{color:var(--accent-primary)}
</style>

<script>
  // @ts-nocheck
  const root = document.querySelector('[data-travel]');
  const content = document.querySelector('[data-travel-content]');
  const cityEl = document.querySelector('[data-travel-city]');
  const countryEl = document.querySelector('[data-travel-country]');
  const routeEl = document.querySelector('[data-travel-route]');
  const bg = document.querySelector('[data-travel-bg]');

  if (root instanceof HTMLElement && content instanceof HTMLElement && cityEl instanceof HTMLElement && countryEl instanceof HTMLElement && routeEl instanceof HTMLElement && bg instanceof HTMLElement) {
    const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const cities = JSON.parse(root.dataset.cities ?? '[]');
    let i = 0;
    const render = () => {
      const c = cities[i % cities.length];
      cityEl.textContent = c.place;
      countryEl.textContent = c.country;
      routeEl.textContent = c.routes?.[0] ?? 'SFO → ---';
      content.querySelector('.status-chip')?.setAttribute('data-label', `×${c.visits}`);
      const chipLabel = content.querySelector('.status-chip__label');
      if (chipLabel) chipLabel.textContent = `×${c.visits}`;
      bg.dispatchEvent(new CustomEvent('travel-city-change', { detail: { city: c.place } }));
    };
    render();
    if (!reduced) {
      setInterval(() => {
        content.classList.add('is-fading');
        setTimeout(() => {
          i = (i + 1) % cities.length;
          render();
          content.classList.remove('is-fading');
        }, 300);
      }, 12000);
    }
  }
</script>
