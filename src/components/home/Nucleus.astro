---
import NucleusCanvas from '@components/home/NucleusCanvas.astro';
---

<div class="container-shell max-wide">
  <section class="nucleus" id="nucleus" aria-label="Nucleus" data-state="ambient">
    <div class="nucleus__frame" data-nucleus>
      <NucleusCanvas />
    </div>
  </section>

  <div class="nucleus-ticker" id="nucleus-ticker">
    <a class="nucleus-ticker__mode" href="/music">
      <span class="nucleus-ticker__mode-icon" aria-hidden="true">♫</span>
      <span class="nucleus-ticker__mode-name">LISTENING</span>
      <span class="nucleus-ticker__mode-counter" id="nucleus-mode-counter">1/6</span>
    </a>

    <span class="nucleus-ticker__divider" aria-hidden="true"></span>

    <div class="nucleus-ticker__hero" id="nucleus-ticker-hero">
      <span class="nucleus-ticker__hero-value" id="nucleus-ticker-hero-value">—</span>
      <span class="nucleus-ticker__hero-unit" id="nucleus-ticker-hero-unit"></span>
    </div>

    <span class="nucleus-ticker__divider" aria-hidden="true"></span>

    <div class="nucleus-ticker__stream">
      <div class="nucleus-ticker__scroll-content" id="nucleus-ticker-scroll">
        <span class="ticker-text">Waiting for data</span>
      </div>
    </div>

    <div class="nucleus-ticker__nav">
      <button class="nucleus-ticker__arrow" id="nucleus-prev" aria-label="Previous mode">‹</button>
      <button class="nucleus-ticker__arrow" id="nucleus-next" aria-label="Next mode">›</button>
    </div>
  </div>
</div>

<style is:global>
  .nucleus { height: clamp(180px, 22vh, 320px); width: 100%; position: relative; overflow: hidden; border: 1px solid var(--border); border-bottom: none; margin: 0; background: var(--surface-primary); }
  .nucleus__frame { position: relative; height: 100%; width: 100%; background: var(--surface-primary); }

  .nucleus-ticker { display:flex; align-items:center; width:100%; height:48px; border-top:1px solid rgba(255,255,255,.08); margin-top:6px; padding:0 12px; background:var(--surface-primary); overflow:hidden; font-family:'IBM Plex Mono',monospace; }
  .nucleus-ticker__mode { display:flex; align-items:center; gap:6px; flex-shrink:0; min-width:140px; padding-right:8px; text-decoration:none; color:inherit; }
  .nucleus-ticker__mode-icon { font-size:12px; color:var(--accent-primary); }
  .nucleus-ticker__mode-name { font-size:11px; font-weight:600; color:var(--text-primary); text-transform:uppercase; letter-spacing:.08em; }
  .nucleus-ticker__mode-counter { font-size:9px; color:var(--text-tertiary); opacity:.6; margin-left:2px; }
  .nucleus-ticker__divider { width:1px; height:20px; background:var(--text-tertiary); opacity:.2; flex-shrink:0; margin:0 12px; }

  .nucleus-ticker__hero { display:flex; align-items:baseline; gap:4px; flex-shrink:0; min-width:120px; }
  .nucleus-ticker__hero-value { font-size:18px; font-weight:700; color:var(--text-primary); letter-spacing:-.02em; font-variant-numeric:tabular-nums; line-height:1; }
  .nucleus-ticker__hero-unit { font-size:9px; font-weight:400; color:var(--text-tertiary); text-transform:lowercase; letter-spacing:.06em; }
  .nucleus-ticker__hero.hero--empty .nucleus-ticker__hero-value { color: var(--text-tertiary); }

  .nucleus-ticker__stream { flex:1; overflow:hidden; min-width:0; mask-image:linear-gradient(to right, transparent 0%, black 2%, black 95%, transparent 100%); -webkit-mask-image:linear-gradient(to right, transparent 0%, black 2%, black 95%, transparent 100%); }
  .nucleus-ticker__scroll-content { display:flex; align-items:center; gap:8px; white-space:nowrap; }
  .nucleus-ticker__scroll-content.is-animated { animation:ticker-scroll var(--scroll-duration, 34s) linear infinite; width:max-content; }
  .nucleus-ticker__scroll-content .ticker-copy { display:inline-flex; align-items:center; gap:8px; }
  .ticker-label { font-size:9px; font-weight:400; color:var(--text-tertiary); text-transform:uppercase; letter-spacing:.08em; }
  .ticker-text { font-size:11px; font-weight:500; color:var(--text-primary); text-transform:none; }
  .ticker-numeric { font-size:12px; font-weight:600; color:var(--text-primary); font-variant-numeric:tabular-nums; }
  .ticker-sep { font-size:8px; color:var(--text-tertiary); opacity:.3; user-select:none; }
  .ticker-chip { font-size:9px; font-weight:600; color:var(--accent-primary); border:1px solid var(--accent-primary); border-radius:9999px; padding:2px 8px; text-transform:uppercase; letter-spacing:.04em; white-space:nowrap; opacity:.8; }

  .nucleus-ticker__nav { display:flex; align-items:center; gap:2px; flex-shrink:0; padding-left:8px; }
  .nucleus-ticker__arrow { appearance:none; border:none; background:none; cursor:pointer; padding:0 8px; font-family:'IBM Plex Mono',monospace; font-size:14px; color:var(--text-tertiary); transition:color .1s ease, background .1s ease; }
  .nucleus-ticker__arrow:hover { color:var(--text-primary); background:rgba(255,255,255,.03); }
  .nucleus-ticker__arrow:focus-visible { outline:1.5px solid var(--accent-primary); outline-offset:-1.5px; }

  @keyframes ticker-scroll { from { transform: translateX(0); } to { transform: translateX(-50%); } }
  @media (prefers-reduced-motion: reduce) { .nucleus-ticker__scroll-content,.nucleus-ticker__scroll-content.is-animated { animation:none; } }
</style>
