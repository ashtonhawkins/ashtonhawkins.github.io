---
import ExperienceCard from "./ExperienceCard.astro";

interface ExperienceItem {
  id: string;
  rangePublic: string;
  rangeConfidential: string;
  [key: string]: unknown;
}

const { experiences } = Astro.props as { experiences: ExperienceItem[] };
---
<section class="flex flex-col gap-6" id="experience">
  <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div class="flex flex-col gap-2">
      <h2 class="text-lg font-semibold text-[color:var(--ink)]">Experience Timeline</h2>
      <p class="text-sm text-[color:var(--ink-2)]">Outcome-first engagements spanning enterprise, SaaS, media, and venture contexts.</p>
    </div>
    <button
      type="button"
      class="inline-flex items-center gap-2 rounded-[var(--r-2)] border border-[color:color-mix(in_srgb,var(--ink)_16%,transparent)] px-4 py-2 text-sm font-semibold text-[color:var(--ink)]"
      data-expand-all
    >
      Expand all
    </button>
  </div>
  <ol class="flex flex-col gap-6 border-l border-[color:color-mix(in_srgb,var(--ink)_16%,transparent)]">
    {experiences.map((experience) => (
      <ExperienceCard experience={experience} />
    ))}
  </ol>
</section>
<script type="module">
const button = document.querySelector<HTMLButtonElement>('[data-expand-all]');
let expanded = false;
const sync = () => {
  const details = document.querySelectorAll<HTMLDetailsElement>('[data-experience-details]');
  details.forEach((detail) => {
    if (expanded) {
      detail.setAttribute('open', 'true');
    } else {
      detail.removeAttribute('open');
    }
  });
  if (button) {
    button.textContent = expanded ? 'Collapse all' : 'Expand all';
  }
};
if (button) {
  button.addEventListener('click', () => {
    expanded = !expanded;
    sync();
  });
}
window.addEventListener('beforeprint', () => {
  expanded = true;
  sync();
});
window.addEventListener('afterprint', () => {
  expanded = false;
  sync();
});
</script>
