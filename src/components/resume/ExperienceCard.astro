---
import type resumeData from "../../data/resume.json";
import { meetsEvidenceThreshold } from "../../utils/metrics";
const { experience } = Astro.props as {
  experience: typeof resumeData.experience[number] & {
    durationApprox: string;
    rangeExact: string;
    tags: string[];
  };
};
---
<details class="group relative flex flex-col gap-4 rounded-2xl border border-[color-mix(in_srgb,var(--ink)_10%,transparent)] bg-[var(--surface-alt)] p-6 shadow-inner shadow-black/5" data-tags={experience.tags.join(",")}> 
  <summary class="flex cursor-pointer list-none flex-col gap-3 focus:outline-none">
    <div class="flex flex-wrap items-baseline justify-between gap-3">
      <div class="flex flex-col">
        <span class="text-sm font-medium text-[var(--ink-2)] confidential-only">{experience.org_confidential}</span>
        <span class="text-sm font-medium text-[var(--ink-2)] public-only">{experience.org_public}</span>
        <span class="text-lg font-semibold text-[var(--ink)] confidential-only">{experience.role_confidential}</span>
        <span class="text-lg font-semibold text-[var(--ink)] public-only">{experience.role_public}</span>
      </div>
      <div class="text-sm text-[var(--ink-2)]">
        <span class="confidential-only">{experience.durationApprox}</span>
        <span class="public-only">{experience.rangeExact}</span>
      </div>
    </div>
    <div class="flex flex-wrap gap-2 text-xs uppercase tracking-wide text-[var(--ink-2)]">
      <span>{experience.team_size} team</span>
      <span>{experience.budget_band}</span>
      <span>{experience.surfaces}</span>
      <span>{experience.stack.join(", ")}</span>
    </div>
  </summary>
  <div class="flex flex-col gap-4">
    <div class="grid gap-3 md:grid-cols-3">
      {experience.metrics.filter((metric) => meetsEvidenceThreshold(metric.sample, metric.confidence)).map((metric) => (
        <div class="rounded-xl border border-[color-mix(in_srgb,var(--ink)_10%,transparent)] bg-[color-mix(in_srgb,var(--surface)_94%,var(--accent)_6%)] p-4 text-sm text-[var(--ink-2)]" key={metric.label}>
          <p class="text-xs uppercase tracking-wide text-[color-mix(in_srgb,var(--ink)_50%,transparent)]">{metric.label}</p>
          <p class="mt-2 text-xl font-semibold text-[var(--ink)]">{metric.delta_pct}%</p>
          {metric.confidence ? <p class="text-xs text-[var(--ink-2)]">{metric.confidence}</p> : null}
        </div>
      ))}
    </div>
    <ul class="list-disc space-y-2 pl-5 text-sm text-[var(--ink)]">
      {experience.impacts.map((impact) => (
        <li key={impact}>{impact}</li>
      ))}
    </ul>
    <div class="flex flex-wrap gap-2 text-sm">
      {experience.artifacts.map((artifact) => (
        <a
          key={artifact.label}
          href={artifact.url}
          class={`rounded-full border border-[color-mix(in_srgb,var(--ink)_12%,transparent)] px-3 py-1.5 text-xs font-medium text-[var(--ink)] transition hover:border-[color-mix(in_srgb,var(--accent)_40%,transparent)] ${artifact.sensitive ? "sensitive-link" : ""}`}
        >
          {artifact.label}
        </a>
      ))}
    </div>
  </div>
</details>
