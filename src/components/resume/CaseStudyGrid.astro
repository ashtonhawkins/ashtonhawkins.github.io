---
interface Receipt {
  label: string;
  url: string;
  sensitive?: boolean;
}

interface CaseStudy {
  id: string;
  title: string;
  thumb: string;
  problem: string;
  approach: string;
  outcome: string;
  url: string;
  receipts: Receipt[];
  sensitive?: boolean;
}

const { caseStudies } = Astro.props as { caseStudies: CaseStudy[] };
const backgroundMap: Record<string, string> = {
  commerce: "linear-gradient(135deg, rgba(8,132,255,0.22), rgba(8,132,255,0.06)), repeating-linear-gradient(45deg, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 1px, transparent 1px, transparent 18px)",
  merch: "linear-gradient(135deg, rgba(255,152,0,0.22), rgba(255,152,0,0.08)), repeating-linear-gradient(-45deg, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 1px, transparent 1px, transparent 16px)",
  lifecycle: "linear-gradient(135deg, rgba(0,184,148,0.18), rgba(0,184,148,0.08)), repeating-linear-gradient(0deg, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 1px, transparent 1px, transparent 20px)",
  revops: "linear-gradient(135deg, rgba(142,68,173,0.22), rgba(142,68,173,0.08)), repeating-linear-gradient(90deg, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 1px, transparent 1px, transparent 14px)",
  marketplace: "linear-gradient(135deg, rgba(52,152,219,0.18), rgba(52,152,219,0.08)), repeating-linear-gradient(45deg, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 1px, transparent 1px, transparent 22px)",
  abm: "linear-gradient(135deg, rgba(231,76,60,0.22), rgba(231,76,60,0.08)), repeating-linear-gradient(-45deg, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 1px, transparent 1px, transparent 18px)",
  pmf: "linear-gradient(135deg, rgba(26,188,156,0.22), rgba(26,188,156,0.08)), repeating-linear-gradient(0deg, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 1px, transparent 1px, transparent 24px)",
  design: "linear-gradient(135deg, rgba(241,196,15,0.22), rgba(241,196,15,0.08)), repeating-linear-gradient(45deg, rgba(255,255,255,0.1) 0, rgba(255,255,255,0.1) 1px, transparent 1px, transparent 18px)",
  personalization: "linear-gradient(135deg, rgba(52,73,94,0.22), rgba(52,73,94,0.08)), repeating-linear-gradient(-45deg, rgba(255,255,255,0.1) 0, rgba(255,255,255,0.1) 1px, transparent 1px, transparent 14px)"
};
const iconMap: Record<string, string> = {
  PR: "ðŸ§¾",
  Dashboard: "ðŸ“Š",
  Doc: "ðŸ“„"
};
---
<section class="flex flex-col gap-6" id="case-studies">
  <div class="flex flex-col gap-2">
    <h2 class="text-lg font-semibold text-[color:var(--ink)]">Portfolio Case Studies</h2>
    <p class="text-sm text-[color:var(--ink-2)]">Story-driven programs with receipts across delivery, analytics, and adoption.</p>
  </div>
  <div class="grid gap-5 md:grid-cols-2">
    {caseStudies.map((item) => {
      const allReceiptsSensitive = item.receipts.length > 0 && item.receipts.every((receipt) => receipt.sensitive);
      return (
        <article
          id={`case-${item.id}`}
          class="group flex flex-col gap-4 rounded-[var(--r-3)] border border-[color:color-mix(in_srgb,var(--ink)_14%,transparent)] bg-[color:color-mix(in_srgb,var(--surface)_94%,transparent)] p-5 shadow-[0_20px_60px_-36px_rgba(12,20,32,0.55)] transition-transform duration-200 ease-[cubic-bezier(.2,.8,.2,1)] hover:-translate-y-1 focus-within:-translate-y-1"
          style={`view-transition-name:case-${item.id};`}
          data-case-study-card
        >
          <div class="flex items-center justify-between text-xs uppercase tracking-[0.24em] text-[color:var(--ink-2)]">
            <span>{item.title}</span>
            {item.sensitive && (
              <span class="rounded-full border border-[color:color-mix(in_srgb,var(--ink)_16%,transparent)] px-2 py-1">
                <span class="confidential-only">Confidential</span>
                <span class="public-only">Public-ready</span>
              </span>
            )}
          </div>
          <div class="relative h-40 overflow-hidden rounded-[var(--r-3)] border border-[color:color-mix(in_srgb,var(--ink)_12%,transparent)]">
            {item.sensitive ? (
              <>
                <div class="confidential-only flex h-full w-full items-center justify-center bg-[color:color-mix(in_srgb,var(--surface-alt)_88%,transparent)] text-sm font-semibold text-[color:var(--ink-2)]">
                  Confidential preview
                </div>
                <div class="public-only h-full w-full" style={`background:${backgroundMap[item.thumb] ?? backgroundMap.commerce};`}></div>
              </>
            ) : (
              <div class="h-full w-full" style={`background:${backgroundMap[item.thumb] ?? backgroundMap.commerce};`}></div>
            )}
          </div>
          <div class="flex flex-col gap-2 text-sm text-[color:var(--ink-2)]">
            <p><strong class="text-[color:var(--ink)]">Problem:</strong> {item.problem}</p>
            <p><strong class="text-[color:var(--ink)]">Approach:</strong> {item.approach}</p>
            <p><strong class="text-[color:var(--ink)]">Outcome:</strong> {item.outcome}</p>
          </div>
          <div class="flex flex-wrap items-center gap-2 text-xs font-semibold uppercase tracking-[0.24em] text-[color:var(--ink-2)]">
            <span>Receipts</span>
            {item.receipts.map((receipt) => (
              <a
                href={receipt.url}
                class={`inline-flex items-center gap-2 rounded-[var(--r-2)] border border-[color:color-mix(in_srgb,var(--ink)_16%,transparent)] px-3 py-2 text-[color:var(--ink)] hover:border-[color:color-mix(in_srgb,var(--accent)_32%,transparent)] ${receipt.sensitive ? "public-only" : ""}`}
                target="_blank"
                rel="noreferrer"
              >
                <span aria-hidden="true">{iconMap[receipt.label] ?? "ðŸ”—"}</span>
                {receipt.label}
              </a>
            ))}
            {allReceiptsSensitive && <span class="confidential-only">Hidden</span>}
          </div>
          <div class="mt-auto">
            {item.sensitive ? (
              <>
                <button type="button" class="confidential-only inline-flex items-center gap-2 rounded-[var(--r-2)] border border-[color:color-mix(in_srgb,var(--ink)_16%,transparent)] px-4 py-2 text-sm font-semibold text-[color:var(--ink-2)]" disabled>
                  Confidential ON
                </button>
                <a
                  href={item.url}
                  class="public-only inline-flex items-center gap-2 rounded-[var(--r-2)] border border-[color:color-mix(in_srgb,var(--ink)_16%,transparent)] px-4 py-2 text-sm font-semibold text-[color:var(--ink)] transition-transform duration-200 ease-[cubic-bezier(.2,.8,.2,1)] hover:-translate-y-0.5"
                  data-astro-transition="animate"
                >
                  View story
                  <span aria-hidden="true">â†—</span>
                </a>
              </>
            ) : (
              <a
                href={item.url}
                class="inline-flex items-center gap-2 rounded-[var(--r-2)] border border-[color:color-mix(in_srgb,var(--ink)_16%,transparent)] px-4 py-2 text-sm font-semibold text-[color:var(--ink)] transition-transform duration-200 ease-[cubic-bezier(.2,.8,.2,1)] hover:-translate-y-0.5"
                data-astro-transition="animate"
              >
                View story
                <span aria-hidden="true">â†—</span>
              </a>
            )}
          </div>
        </article>
      );
    })}
  </div>
</section>
