---
interface CaseStudy {
  id: string;
  title: string;
  thumb: string;
  problem: string;
  approach: string;
  outcome: string;
  tags: string[];
  url?: string;
  sensitive?: boolean;
}

const { caseStudies } = Astro.props as { caseStudies: CaseStudy[] };
---

<section id="case-studies" class="flex flex-col gap-6 rounded-3xl border border-border/60 bg-[color:var(--resume-surface-even)] p-6 shadow-soft md:p-8" aria-label="Case studies">
  <div class="flex flex-col gap-1">
    <span class="text-xs font-semibold uppercase tracking-[0.32em] text-text-muted">Selected engagements</span>
    <h2 class="text-lg font-semibold text-text-primary">Case studies</h2>
  </div>
  <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
    {caseStudies.map((caseStudy) => (
      <component
        this={caseStudy.url ? "a" : "div"}
        href={caseStudy.url}
        data-astro-transition={caseStudy.url ? "animate" : undefined}
        data-astro-prefetch={caseStudy.url ? true : undefined}
        class="group flex flex-col gap-4 rounded-3xl border border-border/70 bg-background/85 p-6 text-left shadow-soft transition-transform duration-100 ease-out hover:-translate-y-1 hover:shadow-ring focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent"
        data-case-study-card
        data-tags={caseStudy.tags.join(",")}
        data-confidential-obscure={caseStudy.sensitive ? "true" : "false"}
        tabindex={caseStudy.url ? undefined : -1}
      >
        <div class="flex items-center gap-4">
          <div class="flex h-14 w-14 items-center justify-center rounded-2xl bg-accent-soft text-sm font-semibold uppercase tracking-wide text-accent">
            <span class="public-token">{caseStudy.thumb.slice(0, 2)}</span>
            {caseStudy.sensitive && (
              <span class="confidential-token hidden text-[11px] font-medium text-text-muted">Confidential</span>
            )}
          </div>
          <h3 class="text-base font-semibold text-text-primary">{caseStudy.title}</h3>
        </div>
        <div class="flex flex-col gap-2 text-xs text-text-secondary">
          <span class="inline-flex flex-wrap items-center gap-2 rounded-full bg-surface/60 px-3 py-2">
            <span class="font-semibold uppercase tracking-[0.2em] text-text-muted">Problem</span>
            <span class="text-left text-text-secondary">{caseStudy.problem}</span>
          </span>
          <span class="inline-flex flex-wrap items-center gap-2 rounded-full bg-surface/60 px-3 py-2">
            <span class="font-semibold uppercase tracking-[0.2em] text-text-muted">Approach</span>
            <span class="text-left text-text-secondary">{caseStudy.approach}</span>
          </span>
          <span class="inline-flex flex-wrap items-center gap-2 rounded-full bg-surface/60 px-3 py-2">
            <span class="font-semibold uppercase tracking-[0.2em] text-text-muted">Outcome</span>
            <span class="text-left text-text-secondary">{caseStudy.outcome}</span>
          </span>
        </div>
        <div class="flex flex-wrap gap-2 pt-2">
          {caseStudy.tags.map((tag) => (
            <span class="inline-flex items-center rounded-full border border-border px-3 py-1 text-xs font-medium text-text-muted transition group-hover:border-accent group-hover:text-text-primary">
              #{tag}
            </span>
          ))}
        </div>
      </component>
    ))}
  </div>
</section>
