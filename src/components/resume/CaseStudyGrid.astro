---
interface Receipt {
  label: string;
  url: string;
  sensitive?: boolean;
}

interface CaseStudyItem {
  id: string;
  title: string;
  thumb: string;
  problem: string;
  approach: string;
  outcome: string;
  receipts: Receipt[];
  sensitive?: boolean;
  tags?: string[];
}

const { caseStudies } = Astro.props as { caseStudies: CaseStudyItem[] };
---
<section class="flex flex-col gap-6" id="case-studies">
  <div class="flex flex-col gap-2">
    <span class="text-xs font-semibold uppercase tracking-[0.32em] text-[color:var(--ink-2)]">Portfolio</span>
    <h2 class="text-lg font-semibold text-[color:var(--ink)]">Case Studies</h2>
    <p class="max-w-3xl text-sm text-[color:var(--ink-2)]">Mode-aware narratives from checkout, taxonomy, search, consent, and program design. Receipts surface when allowed.</p>
  </div>
  <div class="grid gap-6 md:grid-cols-2" data-case-grid>
    {caseStudies.map((item) => {
      const allReceiptsSensitive = item.receipts.length > 0 && item.receipts.every((receipt) => receipt.sensitive);
      return (
        <article
          id={`case-${item.id}`}
          class="group flex h-full flex-col gap-4 overflow-hidden rounded-[var(--r-3)] border border-[color:color-mix(in_srgb,var(--ink)_14%,transparent)] bg-[color:color-mix(in_srgb,var(--surface-alt)_94%,transparent)] shadow-[0_32px_80px_-64px_rgba(12,20,32,0.7)] transition-transform duration-200 ease-[cubic-bezier(.2,.8,.2,1)] hover:-translate-y-1 focus-within:-translate-y-1"
          style={`view-transition-name:case-${item.id}`}
          data-tags={item.tags?.join(",") ?? ""}
          data-filter-item
          data-motion
        >
          <div class="relative h-48 overflow-hidden border-b border-[color:color-mix(in_srgb,var(--ink)_12%,transparent)] bg-[color:color-mix(in_srgb,var(--surface)_92%,transparent)]">
            <img
              src={item.thumb}
              alt={`Diagram for ${item.title}`}
              loading="lazy"
              class={`h-full w-full object-cover transition-opacity duration-200 ease-[cubic-bezier(.2,.8,.2,1)] ${item.sensitive ? "public-only" : ""}`}
            />
            {item.sensitive && (
              <div class="confidential-only absolute inset-0 flex items-center justify-center bg-[color:color-mix(in_srgb,var(--ink)_12%,transparent)] text-sm font-semibold text-[color:var(--ink-2)]">
                Visual redacted
              </div>
            )}
          </div>
          <div class="flex flex-col gap-3 px-5 pb-5 pt-2 text-sm text-[color:var(--ink-2)]">
            <div class="flex flex-wrap items-center justify-between gap-2">
              <h3 class="text-base font-semibold text-[color:var(--ink)]">{item.title}</h3>
              {item.sensitive && (
                <span class="rounded-full border border-[color:color-mix(in_srgb,var(--ink)_16%,transparent)] px-3 py-1 text-[10px] font-semibold uppercase tracking-[0.28em] text-[color:var(--ink-2)]">
                  <span class="confidential-only">Confidential</span>
                  <span class="public-only">Public</span>
                </span>
              )}
            </div>
            <p><strong class="text-[color:var(--ink)]">Problem:</strong> {item.problem}</p>
            <p><strong class="text-[color:var(--ink)]">Approach:</strong> {item.approach}</p>
            <p><strong class="text-[color:var(--ink)]">Outcome:</strong> {item.outcome}</p>
            <div class="flex flex-wrap items-center gap-2 pt-2 text-xs font-semibold uppercase tracking-[0.24em] text-[color:var(--ink-2)]">
              <span>Receipts</span>
              {item.receipts.map((receipt) => (
                <div class="flex items-center gap-2">
                  <a
                    href={receipt.url}
                    target="_blank"
                    rel="noreferrer"
                    class={`inline-flex items-center gap-2 rounded-full border border-[color:color-mix(in_srgb,var(--ink)_16%,transparent)] px-3 py-1.5 text-[color:var(--ink)] transition-colors duration-150 ease-[cubic-bezier(.2,.8,.2,1)] hover:border-[color:color-mix(in_srgb,var(--accent)_28%,transparent)] ${receipt.sensitive ? "public-only" : ""}`}
                  >
                    {receipt.label}
                  </a>
                  {receipt.sensitive && (
                    <span class="confidential-only rounded-full border border-[color:color-mix(in_srgb,var(--ink)_16%,transparent)] px-3 py-1.5 text-[color:var(--ink-2)]">Confidential</span>
                  )}
                </div>
              ))}
              {allReceiptsSensitive && <span class="confidential-only">Hidden</span>}
            </div>
            {item.tags && item.tags.length > 0 && (
              <div class="flex flex-wrap gap-2 pt-2 text-[11px] uppercase tracking-[0.28em] text-[color:var(--ink-2)]">
                {item.tags.map((tag) => (
                  <span class="rounded-full border border-[color:color-mix(in_srgb,var(--ink)_10%,transparent)] px-3 py-1">{tag}</span>
                ))}
              </div>
            )}
          </div>
        </article>
      );
    })}
  </div>
</section>
