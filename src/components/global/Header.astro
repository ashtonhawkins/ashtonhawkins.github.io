---
import ThemeToggle from '@components/global/ThemeToggle.astro';
import Cursor from '@components/ui/Cursor.astro';
import NoiseTexture from '@components/ui/NoiseTexture.astro';
import AnalogClock from '@components/ui/AnalogClock.astro';
import feedCache from '@data/feeds-cache.json';
import siteStats from '@data/site-stats.json';
import commitStats from '@data/commit-stats.json';
import buildWeight from '@data/build-weight.json';

const pathname = Astro.url.pathname;
const links = [
  { href: '/', label: 'Home' },
  { href: '/about', label: 'About' },
  { href: '/work', label: 'Work' },
  { href: '/ventures', label: 'Ventures' },
  { href: '/travel', label: 'Travel' }
];

const mobileLinks = [
  ...links,
  { href: '/now', label: 'Now' },
  { href: '/writing', label: 'Writing' },
  { href: '/photos', label: 'Photos' },
  { href: '/quotes', label: 'Quotes' }
];

const nowFlyoutLinks = [
  { href: '/writing', label: 'Writing' },
  { href: '/photos', label: 'Photos' },
  { href: '/quotes', label: 'Quotes' }
];

const isActive = (href: string) => {
  if (href === '/') return pathname === '/';
  return pathname === href || pathname.startsWith(`${href}/`);
};

const DEPLOY_DATE = new Date();
const LAUNCH_EPOCH = '2025-02-19T00:00:00.000Z';
const totalFeeds = 6;
const feedFlags = {
  letterboxd: ((feedCache as any)?.items?.letterboxd?.length ?? 0) > 0,
  lastfm: ((feedCache as any)?.items?.lastfm?.length ?? 0) > 0,
  strava: Array.isArray((feedCache as any)?.items?.strava) ? ((feedCache as any)?.items?.strava?.length ?? 0) > 0 : false,
  oura: ((feedCache as any)?.items?.oura?.length ?? 0) > 0,
  goodreads: ((feedCache as any)?.items?.goodreads?.length ?? 0) > 0,
  github: ((feedCache as any)?.items?.x?.length ?? 0) > 0
};
const activeFeeds = Object.entries(feedFlags).filter(([, active]) => active).map(([name]) => name);

const siteValue = `${siteStats.components} components · ${(siteStats.lines / 1000).toFixed(1)}K lines`;
const footprintValue = `${Number(buildWeight.kb || 0).toLocaleString()} KB`;
---

<a href="#content" class="skip-link">Skip to content</a>
<header class="site-header" data-header>
  <NoiseTexture opacity={0.02} />
  <div class="header__nav-row header-inner container-shell max-wide">
    <a href="/" class="logotype" aria-label="Ashton Hawkins home" style="view-transition-name: logo-ashton-hawkins;">
      <span class="logotype__text">ASHTON HAWKINS</span>
      <Cursor class="logotype__cursor" />
    </a>

    <nav aria-label="Primary" class="desktop-nav">
      <ul>
        {links.map((link) => (
          <li>
            <a href={link.href} aria-current={isActive(link.href) ? 'page' : undefined} class={isActive(link.href) ? 'active' : undefined}>{link.label}</a>
          </li>
        ))}
        <li class="nav__item nav__item--dropdown">
          <a href="/now" class={`nav__link ${isActive('/now') ? 'active' : ''}`.trim()} aria-current={isActive('/now') ? 'page' : undefined}>NOW</a>
          <div class="nav__flyout" aria-label="Now links">
            {nowFlyoutLinks.map((link) => (
              <a href={link.href} class="nav__flyout-link">{link.label}</a>
            ))}
          </div>
        </li>
      </ul>
    </nav>

    <div class="header__instruments">
      <div class="header__gauge-slot" id="gauge-slot" aria-label="Site vitals">
        <div class="header__gauge" data-gauge="updated" data-deploy-ts={DEPLOY_DATE.toISOString()}>
          <div class="header__gauge-viz" aria-hidden="true">
            <svg class="gauge-viz gauge-viz--ping" width="24" height="24" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="2.5" fill="var(--accent-primary)" />
              <circle cx="12" cy="12" r="2.5" fill="none" stroke="var(--accent-primary)" stroke-width="1" opacity="0">
                <animate attributeName="r" values="2.5;11" dur="2s" begin="0s" repeatCount="indefinite" />
                <animate attributeName="opacity" values="0.6;0" dur="2s" begin="0s" repeatCount="indefinite" />
              </circle>
            </svg>
          </div>
          <div class="header__gauge-text"><span class="header__gauge-label">UPDATED</span><span class="header__gauge-value" id="gauge-updated">just now</span></div>
        </div>

        <div class="header__gauge" data-gauge="alive" data-launch-epoch={LAUNCH_EPOCH}>
          <div class="header__gauge-viz gauge-viz--odometer" aria-hidden="true">
            <span class="odometer-digit" data-odometer-yr>0</span><span class="odometer-unit">y</span>
            <span class="odometer-digit" data-odometer-d>000</span><span class="odometer-unit">d</span>
            <span class="odometer-digit odometer-digit--ticking" data-odometer-h>00</span><span class="odometer-unit">h</span>
          </div>
          <div class="header__gauge-text"><span class="header__gauge-label">ALIVE</span></div>
        </div>

        <div class="header__gauge" data-gauge="visitor">
          <div class="header__gauge-viz gauge-viz--visitor" aria-hidden="true">
            <svg width="36" height="28" viewBox="0 0 36 28" id="visitor-geo-svg">
              <g id="visitor-geo-outline"></g>
              <line id="visitor-radar-sweep" x1="18" y1="14" x2="18" y2="1" stroke="var(--accent-primary)" stroke-width="0.75" opacity="0" transform-origin="18 14" />
              <circle id="visitor-pin" cx="18" cy="14" r="2" fill="var(--accent-primary)" opacity="0" />
            </svg>
          </div>
          <div class="header__gauge-text"><span class="header__gauge-label">VISITOR</span><span class="header__gauge-value" id="gauge-visitor">Welcome</span></div>
        </div>

        <div class="header__gauge" data-gauge="site">
          <div class="header__gauge-viz" aria-hidden="true"><canvas class="gauge-viz gauge-viz--site" width="32" height="32" id="site-cube-canvas"></canvas></div>
          <div class="header__gauge-text"><span class="header__gauge-label">SITE</span><span class="header__gauge-value">{siteValue}</span></div>
        </div>

        <div class="header__gauge" data-gauge="feeds" data-active-feeds={activeFeeds.join(',')}>
          <div class="header__gauge-viz" aria-hidden="true">
            <svg class="gauge-viz gauge-viz--feeds" width="32" height="24" viewBox="0 0 32 24">
              <g id="feeds-connections"></g>
              <circle data-feed="letterboxd" cx="8" cy="4" r="2" class="feed-dot" />
              <circle data-feed="lastfm" cx="24" cy="4" r="2" class="feed-dot" />
              <circle data-feed="strava" cx="4" cy="12" r="2" class="feed-dot" />
              <circle data-feed="oura" cx="28" cy="12" r="2" class="feed-dot" />
              <circle data-feed="goodreads" cx="8" cy="20" r="2" class="feed-dot" />
              <circle data-feed="github" cx="24" cy="20" r="2" class="feed-dot" />
            </svg>
          </div>
          <div class="header__gauge-text"><span class="header__gauge-label">FEEDS</span><span class="header__gauge-value" id="gauge-feeds-value">0 of {totalFeeds} connected</span></div>
        </div>

        <div class="header__gauge" data-gauge="footprint">
          <div class="header__gauge-viz gauge-viz--footprint" aria-hidden="true">
            <svg width="32" height="20" viewBox="0 0 32 20">
              <rect id="footprint-block" x="2" y="2" width="28" height="16" rx="1" fill="var(--accent-primary)" opacity="0.15" stroke="var(--accent-primary)" stroke-width="0.5"/>
              <rect id="footprint-compressed" x="2" y="2" width="3" height="16" rx="1" fill="var(--accent-primary)" opacity="0"/>
            </svg>
          </div>
          <div class="header__gauge-text"><span class="header__gauge-label">FOOTPRINT</span><span class="header__gauge-value">{footprintValue}</span></div>
        </div>

        <div class="header__gauge" data-gauge="activity" data-commits={String(commitStats.weeklyCommits || 0)}>
          <div class="header__gauge-viz gauge-viz--activity" aria-hidden="true">
            <svg width="40" height="12" viewBox="0 0 40 12"><line x1="2" y1="10" x2="38" y2="10" stroke="var(--text-tertiary)" stroke-width="0.5" opacity="0.2"/><g id="activity-dots"></g></svg>
          </div>
          <div class="header__gauge-text"><span class="header__gauge-label">ACTIVITY</span><span class="header__gauge-value" id="gauge-activity-value">quiet this week</span></div>
        </div>

        <div class="header__gauge" data-gauge="stack">
          <div class="header__gauge-viz gauge-viz--stack" aria-hidden="true">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="var(--text-secondary)" opacity="0.6"><path d="M7 1L2 11h3l2-5 2 5h3L7 1z" /></svg>
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="var(--text-secondary)" stroke-width="0.8" opacity="0.6"><polygon points="7,1 12.5,4 12.5,10 7,13 1.5,10 1.5,4" /></svg>
            <svg width="14" height="14" viewBox="0 0 14 14" fill="var(--text-secondary)" opacity="0.6"><rect x="1" y="1" width="12" height="12" rx="2" fill="none" stroke="var(--text-secondary)" stroke-width="0.8"/><text x="7" y="10" font-size="7" font-family="IBM Plex Mono" text-anchor="middle" fill="var(--text-secondary)">TS</text></svg>
          </div>
          <div class="header__gauge-text"><span class="header__gauge-label">BUILT WITH</span><span class="header__gauge-value">Astro · Node · TypeScript</span></div>
        </div>
      </div>

      <div class="header__clock"><AnalogClock /></div>
      <div class="header__utilities">
        <ThemeToggle />
        <button class="cmd-trigger" type="button" aria-label="Open command palette"><span>⌘K</span></button>
        <button class="menu-trigger" type="button" aria-label="Open menu" aria-expanded="false" data-menu-toggle><span></span><span></span><span></span></button>
      </div>
    </div>
  </div>

  <div class="mobile-overlay" data-mobile-menu hidden>
    <nav aria-label="Mobile Primary" class="mobile-nav">
      <ul>{mobileLinks.map((link) => (<li><a href={link.href} aria-current={isActive(link.href) ? 'page' : undefined}>{link.label}</a></li>))}</ul>
    </nav>
    <p class="mobile-kbd-hint">Tip: press <kbd>⌘K</kbd> for command palette</p>
    <p class="mobile-time" data-mobile-time>--:--:--</p>
  </div>
</header>

<script>
  // @ts-nocheck
  import gsap from 'gsap';
  gsap.fromTo('[data-header]', { y: -12, autoAlpha: 0 }, { y: 0, autoAlpha: 1, duration: 0.35, ease: 'power2.out' });

  const header = document.querySelector('[data-header]');
  const toggle = document.querySelector('[data-menu-toggle]');
  const menu = document.querySelector('[data-mobile-menu]');
  const timeEl = document.querySelector('[data-mobile-time]');
  const gaugeSlot = document.getElementById('gauge-slot');

  if (toggle instanceof HTMLButtonElement && menu instanceof HTMLElement) {
    const closeMenu = () => {
      menu.hidden = true;
      toggle.setAttribute('aria-expanded', 'false');
      document.body.classList.remove('menu-open');
    };
    toggle.addEventListener('click', () => {
      const open = toggle.getAttribute('aria-expanded') === 'true';
      if (open) return closeMenu();
      menu.hidden = false;
      toggle.setAttribute('aria-expanded', 'true');
      document.body.classList.add('menu-open');
    });
    menu.querySelectorAll('a').forEach((link) => link.addEventListener('click', closeMenu));
  }

  if (timeEl instanceof HTMLElement) {
    const updateTime = () => { timeEl.textContent = new Intl.DateTimeFormat(undefined, { hour: '2-digit', minute: '2-digit', second: '2-digit' }).format(new Date()); };
    updateTime();
    setInterval(updateTime, 1000);
  }

  if (header instanceof HTMLElement) {
    const updateScrolled = () => header.classList.toggle('scrolled', window.scrollY > 8);
    updateScrolled();
    window.addEventListener('scroll', updateScrolled, { passive: true });
  }

  const gaugeNames = ['updated', 'alive', 'visitor', 'site', 'feeds', 'footprint', 'activity', 'stack'];
  let currentGaugeIndex = 0;
  let gaugeRotationPaused = false;
  let rotationTimer = null;

  const showGauge = (index) => {
    document.querySelectorAll('.header__gauge').forEach((g, i) => g.classList.toggle('active', i === index));
    currentGaugeIndex = index;
  };

  const startRotation = () => {
    if (rotationTimer) clearInterval(rotationTimer);
    rotationTimer = window.setInterval(() => {
      if (gaugeRotationPaused) return;
      showGauge((currentGaugeIndex + 1) % gaugeNames.length);
    }, 5500);
  };

  if (gaugeSlot) {
    gaugeSlot.addEventListener('mouseenter', () => {
      gaugeRotationPaused = true;
    });
    gaugeSlot.addEventListener('mouseleave', () => {
      gaugeRotationPaused = false;
      startRotation();
    });
  }

  const updateUpdatedGauge = () => {
    const el = document.getElementById('gauge-updated');
    const deploy = document.querySelector('[data-gauge="updated"]');
    if (!el || !(deploy instanceof HTMLElement)) return;
    const ts = deploy.dataset.deployTs;
    if (!ts) return;
    const diffSec = Math.floor((Date.now() - new Date(ts).getTime()) / 1000);
    if (diffSec < 60) el.textContent = 'just now';
    else if (diffSec < 3600) el.textContent = `${Math.floor(diffSec / 60)}m ago`;
    else if (diffSec < 86400) el.textContent = `${Math.floor(diffSec / 3600)}h ago`;
    else if (diffSec < 604800) el.textContent = `${Math.floor(diffSec / 86400)}d ago`;
    else el.textContent = new Date(ts).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  };

  const updateAliveGauge = () => {
    const gauge = document.querySelector('[data-gauge="alive"]');
    if (!(gauge instanceof HTMLElement)) return;
    const launch = new Date(gauge.dataset.launchEpoch || '').getTime();
    const elapsed = Date.now() - launch;
    const years = Math.floor(elapsed / (365.25 * 24 * 3600 * 1000));
    const days = Math.floor((elapsed % (365.25 * 24 * 3600 * 1000)) / (24 * 3600 * 1000));
    const hours = Math.floor((elapsed % (24 * 3600 * 1000)) / (3600 * 1000));
    const yrEl = document.querySelector('[data-odometer-yr]');
    const dEl = document.querySelector('[data-odometer-d]');
    const hEl = document.querySelector('[data-odometer-h]');
    if (yrEl) yrEl.textContent = String(years);
    if (dEl) dEl.textContent = String(days).padStart(3, '0');
    if (hEl) {
      const next = String(hours).padStart(2, '0');
      if (hEl.textContent !== next) {
        hEl.classList.add('rolling');
        setTimeout(() => {
          hEl.textContent = next;
          hEl.classList.remove('rolling');
        }, 180);
      }
    }
  };

  const initVisitorGauge = async () => {
    const valueEl = document.getElementById('gauge-visitor');
    const outlineEl = document.getElementById('visitor-geo-outline');
    const sweepEl = document.getElementById('visitor-radar-sweep');
    const pinEl = document.getElementById('visitor-pin');
    try {
      const geo = await fetch('https://ipapi.co/json/').then((r) => r.json());
      const city = geo.city || 'Welcome';
      const region = geo.region_code || '';
      valueEl && (valueEl.textContent = region ? `${city}, ${region}` : city);
      if (outlineEl) {
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', 'M4,14 L8,6 L18,4 L30,7 L32,14 L28,21 L16,24 L7,22 Z');
        path.setAttribute('fill', 'none');
        path.setAttribute('stroke', 'var(--text-tertiary)');
        path.setAttribute('stroke-width', '0.75');
        path.setAttribute('opacity', '0.5');
        outlineEl.appendChild(path);
      }
      sweepEl?.animate([{ transform: 'rotate(0deg)', opacity: 0.6 }, { transform: 'rotate(360deg)', opacity: 0 }], { duration: 1500, easing: 'ease-out', fill: 'forwards' });
      if (pinEl && geo.latitude && geo.longitude) {
        setTimeout(() => {
          pinEl.setAttribute('cx', String(18 + (geo.longitude % 8)));
          pinEl.setAttribute('cy', String(14 - (geo.latitude % 6)));
          pinEl.setAttribute('opacity', '1');
        }, 1500);
      }
    } catch {
      valueEl && (valueEl.textContent = 'Welcome');
    }
  };

  const initFeedsConstellation = () => {
    const gaugeEl = document.querySelector('[data-gauge="feeds"]');
    const valueEl = document.getElementById('gauge-feeds-value');
    const connectionsEl = document.getElementById('feeds-connections');
    if (!(gaugeEl instanceof HTMLElement) || !(connectionsEl instanceof SVGGElement)) return;
    const activeFeeds = (gaugeEl.dataset.activeFeeds || '').split(',').filter(Boolean);
    const dots = document.querySelectorAll('.feed-dot');
    const positions = {};
    dots.forEach((dot) => {
      const feedName = dot.dataset.feed;
      positions[feedName] = { x: Number(dot.getAttribute('cx')), y: Number(dot.getAttribute('cy')) };
      if (activeFeeds.includes(feedName)) dot.classList.add('feed-dot--active');
    });
    for (let i = 0; i < activeFeeds.length; i++) {
      for (let j = i + 1; j < activeFeeds.length; j++) {
        const a = positions[activeFeeds[i]];
        const b = positions[activeFeeds[j]];
        if (!a || !b) continue;
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', a.x); line.setAttribute('y1', a.y); line.setAttribute('x2', b.x); line.setAttribute('y2', b.y);
        connectionsEl.appendChild(line);
      }
    }
    if (valueEl) valueEl.textContent = `${activeFeeds.length} of 6 connected`;
  };

  const initFootprintViz = () => {
    const block = document.getElementById('footprint-block');
    const compressed = document.getElementById('footprint-compressed');
    if (!block || !compressed) return;
    block.animate([{ width: 28, opacity: 0.15 }, { width: 3, opacity: 0.08 }], { duration: 1000, easing: 'ease-in-out', fill: 'forwards', delay: 500 });
    setTimeout(() => compressed.setAttribute('opacity', '0.6'), 1500);
  };

  const initActivityViz = () => {
    const dotsEl = document.getElementById('activity-dots');
    const gaugeEl = document.querySelector('[data-gauge="activity"]');
    const valueEl = document.getElementById('gauge-activity-value');
    if (!(dotsEl instanceof SVGGElement) || !(gaugeEl instanceof HTMLElement)) return;
    const commitCount = parseInt(gaugeEl.dataset.commits || '0', 10);
    for (let i = 0; i < Math.min(commitCount, 7); i++) {
      const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      circle.setAttribute('cx', String(4 + i * 5));
      circle.setAttribute('cy', '6');
      circle.setAttribute('r', '2');
      circle.setAttribute('fill', 'var(--accent-primary)');
      dotsEl.appendChild(circle);
    }
    if (valueEl) valueEl.textContent = commitCount > 0 ? `${commitCount} commits this week` : 'quiet this week';
  };

  const initSiteCubeViz = () => {
    const canvas = document.getElementById('site-cube-canvas');
    if (!(canvas instanceof HTMLCanvasElement)) return;
    const ctx = canvas.getContext('2d');
    if (!ctx) return;
    let raf = null;
    let angle = 0;
    const draw = () => {
      ctx.clearRect(0, 0, 32, 32);
      ctx.strokeStyle = 'rgba(140,150,170,.5)';
      ctx.strokeRect(8 + Math.sin(angle) * 2, 8, 14, 14);
      ctx.strokeRect(10, 10 + Math.cos(angle) * 2, 14, 14);
      ctx.fillStyle = 'var(--accent-primary)';
      ctx.beginPath(); ctx.arc(16 + Math.sin(angle) * 6, 16 + Math.cos(angle) * 4, 1.5, 0, Math.PI * 2); ctx.fill();
      angle += 0.02;
      raf = requestAnimationFrame(draw);
    };
    const observer = new IntersectionObserver(([entry]) => {
      if (entry.isIntersecting) draw();
      else if (raf) cancelAnimationFrame(raf);
    });
    observer.observe(canvas);
  };

  showGauge(0);
  startRotation();
  updateUpdatedGauge();
  updateAliveGauge();
  initVisitorGauge();
  initFeedsConstellation();
  initFootprintViz();
  initActivityViz();
  initSiteCubeViz();
  setInterval(updateUpdatedGauge, 60000);
  setInterval(updateAliveGauge, 60 * 1000);
</script>

<style>
  .skip-link { position:absolute; left:-999px; top:0; }
  .skip-link:focus-visible { left:1rem; top:1rem; background:var(--surface-primary); padding:.5rem .75rem; z-index:60; }
  .site-header { position: sticky; top:0; z-index:50; backdrop-filter: blur(8px); background: color-mix(in srgb, var(--surface-primary) 90%, transparent); isolation:isolate; border-bottom:1px solid var(--border); }
  .header-inner { position:relative; z-index:2; display:flex; align-items:center; width:100%; min-height:56px; padding-inline:var(--content-padding); gap:1.5rem; }
  .logotype { flex-shrink:0; font-family:'IBM Plex Mono',monospace; font-weight:700; color:var(--text-primary); text-decoration:none; display:inline-flex; align-items:center; font-size:1.25rem; letter-spacing:.15em; text-transform:uppercase; }
  .desktop-nav{display:none;flex-shrink:0;} .desktop-nav ul{list-style:none;display:flex;gap:1.1rem;padding:0;margin:0;align-items:center;}
  .desktop-nav a, .nav__link{font-family:'IBM Plex Mono',monospace;font-size:.75rem;font-weight:500;letter-spacing:.08em;text-transform:uppercase;color:var(--text-secondary);text-decoration:none;padding:.35rem 0;border-bottom:2px solid transparent;display:inline-flex;align-items:center;height:100%;}
  .desktop-nav a.active,.desktop-nav a:hover,.nav__link.active,.nav__link:hover{color:var(--text-primary);} .desktop-nav a.active,.nav__link.active{border-bottom-color:var(--accent-primary);}
  .nav__item--dropdown { position: relative; display:flex; align-items:center; }
  .nav__flyout { position:absolute; top:calc(100% + 2px); left:0; display:flex; flex-direction:column; background:var(--surface-primary); border:1px solid var(--border); opacity:0; visibility:hidden; }
  .nav__item--dropdown:hover .nav__flyout,.nav__item--dropdown:focus-within .nav__flyout{opacity:1;visibility:visible;}
  .nav__flyout-link { padding:4px 8px; font-family:'IBM Plex Mono',monospace; font-size:10px; text-transform:uppercase; color:var(--text-secondary); text-decoration:none; }

  .header__instruments {display:flex;align-items:center;gap:12px;margin-left:auto;min-width:0;}
  .header__gauge-slot { position:relative; min-width:360px; height:38px; display:flex; align-items:center; justify-content:flex-end; margin-right:12px; overflow:visible; border:none; background:none; box-shadow:none; padding:0; border-radius:0; }
  .header__gauge { position:absolute; inset:0; display:flex; align-items:center; gap:8px; white-space:nowrap; opacity:0; pointer-events:none; transition:opacity .4s ease; }
  .header__gauge.active { opacity:1; pointer-events:auto; }
  .header__gauge-viz{flex-shrink:0;display:flex;align-items:center;justify-content:center;}
  .header__gauge-text{display:flex;align-items:baseline;gap:6px;}
  .header__gauge-label{font-family:'IBM Plex Mono',monospace;font-size:9px;font-weight:400;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:.1em;}
  .header__gauge-value{font-family:'IBM Plex Mono',monospace;font-size:12px;font-weight:500;color:var(--text-primary);text-transform:none;letter-spacing:.02em;}

  .gauge-viz--odometer{font-family:'IBM Plex Mono',monospace;font-size:13px;font-weight:700;color:var(--text-primary);font-variant-numeric:tabular-nums;}
  .odometer-unit{font-size:9px;color:var(--text-tertiary);margin:0 2px;}
  .odometer-digit--ticking.rolling{transform:translateY(-2px);opacity:.5;transition:all .2s ease;}
  .feed-dot{fill:none;stroke:var(--text-tertiary);stroke-width:.75;opacity:.3}
  .feed-dot--active{fill:var(--accent-primary);stroke:var(--accent-primary);opacity:1}
  #feeds-connections line{stroke:var(--accent-primary);stroke-width:.5;opacity:.3}
  .gauge-viz--stack{display:flex;align-items:center;gap:6px}

  .header__clock { display:none; }
  .header__utilities { display:flex; align-items:center; gap:8px; }
  .cmd-trigger{display:none;} .menu-trigger{display:inline-flex;flex-direction:column;gap:3px;background:none;border:0;color:inherit;padding:4px;}
  .menu-trigger span{display:block;width:16px;height:1px;background:currentColor;}
  .mobile-overlay{display:none;}

  @media (min-width: 880px){ .desktop-nav{display:block;} .header__clock{display:block;} .menu-trigger{display:none;} .cmd-trigger{display:inline-flex;background:none;border:1px solid var(--border);padding:2px 6px;color:var(--text-secondary);} }
  @media (max-width: 879px){ .header__gauge-slot{display:none;} }

  @media (prefers-reduced-motion: reduce) {
    .gauge-viz canvas, .gauge-viz svg animate, .gauge-viz svg [style*='animation'] { animation: none !important; transition: none !important; }
    #visitor-pin { opacity: 1; }
    #footprint-block { width: 3; }
  }
</style>
