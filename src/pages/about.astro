---
import AppShell from "../layouts/AppShell.astro";
import SEO from "../components/SEO.astro";
import SystemDial from "../components/SystemDial.astro";
import GaugeBar from "../components/GaugeBar.astro";
import Sparkline from "../components/Sparkline.astro";
import OrbitMap from "../components/OrbitMap.astro";
import ProcessTable from "../components/ProcessTable.astro";
import ToggleRow from "../components/ToggleRow.astro";
import {
  heroDial,
  heroMetrics,
  movementRecovery,
  navDestinations,
  orbitWorlds,
  preferences,
  processes,
  sensorReadings,
  statusTemplates,
  explorationZones,
  worlds,
} from "../data/aboutConfig";

const randomStatus = statusTemplates[Math.floor(Math.random() * statusTemplates.length)];
---

<AppShell>
  <SEO
    slot="head"
    title="About · Ashton Hawkins"
    description="A personal operating system snapshot—movement, cycling, recovery, and exploration."
  />

  <main class="mx-auto flex max-w-6xl flex-col gap-14 px-4 py-12 sm:px-6 lg:px-8">
    <section class="grid items-center gap-10 lg:grid-cols-[minmax(0,1.08fr)_minmax(0,0.92fr)]">
      <div class="flex flex-col gap-6">
        <div class="flex flex-col gap-3">
          <p class="text-sm uppercase tracking-[0.12em] text-text-tertiary">Personal OS</p>
          <h1 class="text-balance text-4xl font-semibold text-text-primary sm:text-5xl">Ashton Hawkins</h1>
          <p class="text-lg leading-relaxed text-text-secondary sm:text-xl">
            I optimize experiences, itineraries, and systems—for screens and real life.
          </p>
        </div>
        <div class="flex flex-wrap gap-2 text-sm text-text-secondary">
          {["Movement & routes", "Cycling", "Recovery experiments", "Product & systems"].map((mode) => (
            <span class="rounded-full border border-border bg-surface px-3 py-1 text-sm shadow-sm">{mode}</span>
          ))}
        </div>
        <p
          id="status-line"
          data-templates={JSON.stringify(statusTemplates)}
          class="rounded-2xl border border-border/70 bg-surface/90 px-4 py-3 text-base leading-relaxed text-text-secondary"
        >
          {randomStatus}
        </p>
        <div class="grid gap-4 sm:grid-cols-2">
          <div class="rounded-3xl border border-border/70 bg-surface/90 p-4 shadow-sm">
            <p class="text-xs uppercase tracking-[0.14em] text-text-tertiary">System summary</p>
            <div class="mt-3 grid gap-3 text-sm text-text-primary">
              <div class="flex items-center justify-between rounded-2xl border border-border/60 bg-surface/70 px-3 py-2">
                <span class="text-text-secondary">Hostname</span>
                <span class="font-semibold">ASHTON</span>
              </div>
              <div class="flex items-center justify-between rounded-2xl border border-border/60 bg-surface/70 px-3 py-2">
                <span class="text-text-secondary">OS</span>
                <span class="font-semibold">Personal OS v1.x</span>
              </div>
              <div class="flex items-center justify-between rounded-2xl border border-border/60 bg-surface/70 px-3 py-2">
                <span class="text-text-secondary">Mode</span>
                <span class="font-semibold">High curiosity · steady movement</span>
              </div>
              <div class="flex items-center justify-between rounded-2xl border border-border/60 bg-surface/70 px-3 py-2">
                <span class="text-text-secondary">Primary loops</span>
                <span class="text-right font-semibold">Travel itineraries · cycling · recovery experiments · product systems</span>
              </div>
            </div>
          </div>
          <div class="rounded-3xl border border-border/70 bg-surface/90 p-4 shadow-sm">
            <p class="text-xs uppercase tracking-[0.14em] text-text-tertiary">Sensors</p>
            <div class="mt-3 flex flex-col gap-4">
              {sensorReadings.map((sensor) => (
                <GaugeBar
                  label={sensor.label}
                  description={sensor.description}
                  current={sensor.current}
                  min={sensor.min}
                  max={sensor.max}
                  variant={sensor.variant}
                />
              ))}
            </div>
          </div>
        </div>
      </div>

      <div class="flex flex-col items-center gap-4 lg:items-end">
        <SystemDial
          rings={heroDial.rings}
          centerTitle={heroDial.centerTitle}
          centerSubtitle={heroDial.centerSubtitle}
          ariaLabel="Movement, exploration, and recovery dial"
        />
        <p class="max-w-md text-center text-xs text-text-tertiary lg:text-right">
          Hover or focus a ring to thicken it; tooltips reveal the sensor label. Approximate, intentionally fuzzy readings.
        </p>
      </div>
    </section>

    <section class="rounded-3xl border border-border/70 bg-surface/90 p-6 shadow-sm">
      <div class="flex items-center justify-between gap-4">
        <div>
          <p class="text-xs uppercase tracking-[0.14em] text-text-tertiary">Hero metrics</p>
          <h2 class="text-2xl font-semibold text-text-primary sm:text-3xl">Year-to-date signals</h2>
        </div>
        <span class="flex items-center gap-2 text-sm text-text-tertiary">
          <span class="h-2 w-2 rounded-full bg-green-400" /> Stable
        </span>
      </div>
      <div class="mt-4 grid gap-4 lg:grid-cols-2">
        {heroMetrics.map((metric) => (
          <article class="rounded-2xl border border-border/60 bg-surface/80 p-5 shadow-sm">
            <header class="flex items-center justify-between gap-3">
              <p class="text-xs uppercase tracking-[0.08em] text-text-tertiary">{metric.title}</p>
              <span class="rounded-full bg-primary/10 px-3 py-1 text-[11px] font-semibold text-primary">Live</span>
            </header>
            <p class="text-3xl font-semibold text-text-primary">{metric.value}</p>
            <p class="text-sm text-text-secondary">{metric.detail}</p>
            <div class="mt-3">
              <Sparkline values={metric.sparkline} />
            </div>
          </article>
        ))}
      </div>
    </section>

    <section class="flex flex-col gap-4">
      <div class="flex items-baseline justify-between gap-4">
        <div>
          <h2 class="text-2xl font-semibold text-text-primary sm:text-3xl">Worlds I move in</h2>
          <p class="text-text-secondary">Sensors around the arenas that keep the system interesting.</p>
        </div>
      </div>
      <div class="grid gap-6 lg:grid-cols-[minmax(0,0.85fr)_minmax(0,1.15fr)] lg:items-center">
        <div class="flex justify-center lg:justify-start">
          <OrbitMap nodes={orbitWorlds} targetId="worlds-grid" />
        </div>
        <div id="worlds-grid" class="divide-y divide-border/70 overflow-hidden rounded-3xl border border-border/70 bg-surface/80">
          {worlds.map((world) => (
            <article
              class="flex flex-col gap-2 px-5 py-5 transition duration-300 data-[highlight='true']:bg-primary/5"
              data-world-card
              data-world-id={world.id}
            >
              <header class="flex items-center justify-between">
                <h3 class="text-lg font-semibold text-text-primary sm:text-xl">{world.title}</h3>
                <span class="text-[11px] uppercase tracking-[0.1em] text-text-tertiary">{world.id.replace("-", " ")}</span>
              </header>
              <p class="text-sm leading-relaxed text-text-secondary sm:text-base">{world.description}</p>
              <p class="text-xs uppercase tracking-[0.08em] text-text-tertiary">{world.tags.join(" · ")}</p>
            </article>
          ))}
        </div>
      </div>
    </section>

    <section class="grid gap-8 lg:grid-cols-2 lg:items-stretch">
      <article class="flex flex-col gap-4 rounded-3xl border border-border/70 bg-surface p-6 shadow-sm">
        <div class="flex items-center justify-between gap-3">
          <div>
            <h2 class="text-2xl font-semibold text-text-primary">Exploration profile</h2>
            <p class="text-text-secondary">Zones I gravitate toward—rendered as lightweight gauges.</p>
          </div>
          <span class="rounded-full bg-primary/10 px-3 py-1 text-xs font-medium text-primary">Abstracted</span>
        </div>
        <div class="grid gap-3">
          {explorationZones.map((zone) => (
            <div class="rounded-2xl border border-border/60 bg-surface/70 px-4 py-3">
              <div class="flex items-center justify-between gap-3">
                <div class="flex items-center gap-3">
                  <span class="h-8 w-1.5 rounded-full bg-gradient-to-b from-primary/70 to-secondary/70" aria-hidden="true" />
                  <div>
                    <p class="text-[11px] uppercase tracking-[0.08em] text-text-tertiary">{zone.id.replace("-", " ")}</p>
                    <p class="text-base font-medium text-text-primary">{zone.label}</p>
                  </div>
                </div>
                <span class="text-sm font-semibold text-text-secondary">{zone.descriptor}</span>
              </div>
              <div class="mt-2">
                <GaugeBar label="Intensity" current={zone.scaled} min={0} max={1} variant="subtle" />
              </div>
            </div>
          ))}
        </div>
        <p class="text-xs text-text-tertiary">Approximate ranges only—no coordinates or dates stored here.</p>
      </article>

      <article class="flex flex-col gap-4 rounded-3xl border border-border/70 bg-surface p-6 shadow-sm">
        <div class="flex items-center justify-between gap-3">
          <div>
            <h2 class="text-2xl font-semibold text-text-primary">Movement & recovery</h2>
            <p class="text-text-secondary">Cycling, rest, and cadence rendered as soft bars.</p>
          </div>
          <span class="rounded-full bg-secondary/10 px-3 py-1 text-xs font-medium text-secondary">Approximate</span>
        </div>
        <div class="grid gap-4">
          {movementRecovery.gauges.map((gauge) => (
            <GaugeBar
              label={gauge.label}
              description={gauge.description}
              current={gauge.current}
              min={gauge.min}
              max={gauge.max}
              variant={gauge.variant}
            />
          ))}
        </div>
      </article>
    </section>

    <ProcessTable cpuLoad={processes.cpuLoad} items={processes.items} />

    <section class="flex flex-col gap-4">
      <div class="flex items-baseline justify-between gap-4">
        <div>
          <h2 class="text-2xl font-semibold text-text-primary sm:text-3xl">Config & preferences</h2>
          <p class="text-text-secondary">Simple toggles that keep the system running smoothly.</p>
        </div>
      </div>
      <div class="grid gap-3 rounded-3xl border border-border/70 bg-surface/90 p-5">
        {preferences.map((pref) => (
          <ToggleRow label={pref.label} value={pref.value} description={pref.description} />
        ))}
      </div>
    </section>

    <section class="flex flex-col gap-3 pb-4">
      <p class="text-sm uppercase tracking-[0.12em] text-text-tertiary">Where to next?</p>
      <div class="grid gap-3 rounded-3xl border border-border/70 bg-surface/90 p-4 shadow-sm sm:grid-cols-2">
        {navDestinations.map((item) => (
          <a
            class="group flex items-center justify-between rounded-2xl border border-border/70 bg-surface px-4 py-3 text-sm font-medium text-text-primary shadow-sm transition duration-300 hover:-translate-y-0.5 hover:border-primary/70 hover:shadow-md focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary"
            href={item.href}
          >
            <div class="flex items-center gap-3">
              <span class="flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-primary/15 to-secondary/15 text-base font-semibold text-primary transition duration-300 group-hover:from-primary/25 group-hover:to-secondary/25">
                ●
              </span>
              <div class="flex flex-col text-left">
                <span class="text-base font-semibold text-text-primary">{item.label}</span>
                <span class="text-xs text-text-secondary">{item.meta}</span>
              </div>
            </div>
            <span class="text-[11px] uppercase tracking-[0.1em] text-text-tertiary">Open</span>
          </a>
        ))}
      </div>
    </section>
  </main>
</AppShell>

<script type="module">
  const statusEl = document.getElementById("status-line");
  if (statusEl) {
    try {
      const templates = JSON.parse(statusEl.dataset.templates || "[]");
      if (Array.isArray(templates) && templates.length) {
        const pick = templates[Math.floor(Math.random() * templates.length)];
        if (pick) {
          statusEl.textContent = pick;
        }
      }
    } catch (error) {
      console.error("Status template parsing failed", error);
    }
  }
</script>
