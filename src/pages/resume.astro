---
import "../styles/global.css";
import { getEntry } from "astro:content";
import SEO from "../components/SEO.astro";
import BeforeAfter from "../components/BeforeAfter";
import ExperienceTimeline from "../components/ExperienceTimeline";
import CommandPalette from "../components/CommandPalette";
import ShaderBackdrop from "../components/ShaderBackdrop";

const resume = await getEntry('resume', 'data');
const data = resume.data;
const pageTitle = `${data.person.name} Â· ${data.person.title}`;
const desc = data.person.blurb;

const actions = [
  { id:"email", label:`Email ${data.person.name}`, href:`mailto:${data.person.email}` },
  { id:"pdf", label:"Print / Save PDF", href:"#print" },
  { id:"json", label:"Export JSON", href:"/api/resume.json" },
  ...(data.person.urls.site ? [{ id:"site", label:"Open Website", href:data.person.urls.site }] : []),
  ...(data.person.urls.linkedin ? [{ id:"li", label:"Open LinkedIn", href:data.person.urls.linkedin }] : []),
  ...(data.person.urls.github ? [{ id:"gh", label:"Open GitHub", href:data.person.urls.github }] : []),
];
---
<html lang="en">
  <head>
    <SEO title={pageTitle} description={desc} url="https://www.ashtonhawkins.com/resume" person={data.person} resume={data} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body class="min-h-screen bg-neutral-950 text-neutral-100">
    <ShaderBackdrop client:visible />
    <header class="relative z-10 mx-auto max-w-5xl px-6 py-16">
      <h1 class="text-4xl md:text-6xl font-bold tracking-tight">{data.person.title}</h1>
      <p class="mt-4 max-w-2xl text-neutral-300">{data.person.blurb}</p>
      <p class="mt-2 text-sm text-neutral-400">{data.person.location}</p>

      <div class="mt-6 flex gap-3 text-sm">
        <a href={`mailto:${data.person.email}`} class="px-3 py-1 rounded bg-white/10 hover:bg-white/20">Email</a>
        <a href="/api/resume.json" class="px-3 py-1 rounded bg-white/10 hover:bg-white/20">Export JSON</a>
        <a href="#print" class="px-3 py-1 rounded bg-white/10 hover:bg-white/20">Print / Save PDF</a>
      </div>
    </header>

    <main class="relative z-10 mx-auto max-w-5xl px-6 pb-24">
      <section id="keywords" class="mb-10">
        <h2 class="text-xl font-semibold">Filter by keyword</h2>
        <p class="text-neutral-400 text-sm">Syncs to URL</p>
        <div class="mt-3 flex flex-wrap gap-2">
          {data.keywords.map(k => <a href={`?q=${encodeURIComponent(k)}`} class="text-xs px-2 py-1 rounded border border-white/10 hover:bg-white/10">{k}</a>)}
        </div>
      </section>

      <section id="before-after" class="mb-16">
        <h2 class="text-xl font-semibold">Before / After</h2>
        <p class="text-neutral-400 text-sm mb-4">Drag to compare</p>
        <BeforeAfter client:visible before="/images/before.jpg" after="/images/after.jpg" altBefore="Before" altAfter="After" />
      </section>

      <section id="timeline" class="mb-16">
        <h2 class="text-xl font-semibold">Experience Timeline</h2>
        <ExperienceTimeline client:visible items={data.work} />
      </section>

      <section id="projects" class="mb-16">
        <h2 class="text-xl font-semibold">Selected Projects</h2>
        <div class="mt-6 grid gap-6 md:grid-cols-2">
          {data.projects.map(p => (
            <article class="rounded-lg border border-white/10 p-4 card">
              <h3 class="font-medium">{p.name}</h3>
              <p class="text-sm text-neutral-400">{p.period}</p>
              <p class="mt-2 text-neutral-300">{p.summary}</p>
              <div class="mt-3 flex flex-wrap gap-2">
                {p.tags.map(t => <span class="text-xs px-2 py-1 rounded bg-white/5">{t}</span>)}
              </div>
            </article>
          ))}
        </div>
      </section>
    </main>

    <CommandPalette client:idle actions={actions} />

    <script>
      document.addEventListener('click', (e) => {
        const a = e.target.closest('a');
        if (!a) return;
        if (a.getAttribute('href') === '#print' || a.hash === '#print') {
          e.preventDefault();
          window.print();
        }
      });
    </script>
  </body>
</html>
