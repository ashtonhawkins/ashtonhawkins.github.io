---
import ResumeLayout from "../layouts/ResumeLayout.astro";
import data from "../data/resume.json";
import Hero from "../components/resume/Hero.astro";
import Scoreboard from "../components/resume/Scoreboard.astro";
import BeforeAfter from "../components/resume/BeforeAfter.astro";
import ExperimentGallery from "../components/resume/ExperimentGallery.astro";
import ImpactTapestry from "../components/resume/ImpactTapestry.astro";
import CaseStudyGrid from "../components/resume/CaseStudyGrid.astro";
import ExperienceTimeline from "../components/resume/ExperienceTimeline.astro";
import CapabilitiesMap from "../components/resume/CapabilitiesMap.astro";
import ActionDock from "../components/resume/ActionDock.astro";
import KeywordFilters from "../components/resume/KeywordFilters.astro";
import { approxYears, formatRange } from "../utils/dates";

const initialMode = "confidential";

const caseStudyTags: Record<string, string[]> = {
  "cs-checkout-simplification": ["Checkout", "CRO", "Optimizely", "Experiment design"],
  "cs-taxonomy-ia": ["SEO", "Taxonomy", "Information Architecture", "Navigation"],
  "cs-search": ["Search", "SEO", "Core Web Vitals"],
  "cs-consent": ["Consent Mode v2", "GA4", "Data layer"],
  "cs-attach-wizard": ["Onboarding", "Experiment design", "Optimizely"],
  "cs-program": ["Program governance", "RICE prioritization", "Dashboards"]
};

const experienceTags: Record<string, string[]> = {
  "exp-retail-portfolio": ["CRO", "Checkout", "SEO", "Taxonomy", "Optimizely", "GA4", "BigQuery", "Program governance"],
  "exp-saas-commerce": ["Onboarding", "Experiment design", "Consent Mode v2", "Optimizely", "Amplitude", "GA4"],
  "exp-dtc-health": ["PDP", "Experiment design", "Monetate", "GA4"],
  "exp-independent": ["Astro", "Tailwind", "Cloudflare", "Dashboards"]
};

const caseStudies = data.caseStudies.map((study) => ({
  ...study,
  tags: caseStudyTags[study.id] ?? []
}));

const experiences = data.experience.map((exp) => ({
  ...exp,
  durationApprox: approxYears(exp.start, exp.end),
  rangeExact: formatRange(exp.start, exp.end),
  tags: experienceTags[exp.id]?.filter(Boolean) ?? []
}));
---
<ResumeLayout title="Resume â€” Ashton Hawkins">
  <style>
    main {
      max-width: 1120px;
      margin: 0 auto;
      padding: 4rem 1.5rem 6rem;
      display: flex;
      flex-direction: column;
      gap: 3rem;
    }
    [data-confidential="confidential"] .public-only {
      display: none !important;
    }
    [data-confidential="public"] .confidential-only {
      display: none !important;
    }
    [data-confidential="confidential"] .sensitive-link {
      display: none !important;
    }
  </style>
  <main>
    <div class="relative">
      <Hero hero={data.hero} bioShort={data.bioShort} initialMode={initialMode} />
      <div class="lg:absolute lg:top-8 lg:right-8">
        <ActionDock data={data} bio={data.bioShort} />
      </div>
    </div>
    <KeywordFilters keywords={data.keywords} />
    <Scoreboard kpis={data.kpis} />
    <BeforeAfter items={data.beforeAfter} />
    <ExperimentGallery experiments={data.experiments} />
    <ImpactTapestry items={data.tapestry} />
    <CaseStudyGrid caseStudies={caseStudies} />
    <ExperienceTimeline experience={experiences} />
    <CapabilitiesMap capabilities={data.capabilities} />
  </main>
</ResumeLayout>
