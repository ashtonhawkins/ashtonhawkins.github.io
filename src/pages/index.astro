---
import Base from '@layouts/Base.astro';
import '@styles/coming-soon.css';
---

<Base
  title="Ashton Hawkins — Personal Operating System"
  description="Connection logged. Ashton Hawkins — digital infrastructure, growth systems, and platform operations."
  robots="noindex"
>
  <main class="cs-root" aria-label="Personal operating system">
    <canvas id="noise-canvas" class="noise-canvas" aria-hidden="true"></canvas>

    <section class="cs-viewport">
      <div id="boot-sequence" class="cs-terminal" aria-live="polite"></div>
    </section>

    <section class="cs-query-wrap" id="query-shell">
      <div id="query-output" class="cs-query-output" aria-live="polite"></div>
      <label class="cs-query">
        <span class="cs-query-label">QUERY //</span>
        <input
          id="query-input"
          class="cs-query-input"
          type="text"
          autocapitalize="off"
          autocomplete="off"
          spellcheck="false"
          placeholder="ENTER COMMAND OR TYPE 'CATALOG' FOR DIRECTORY"
        />
      </label>
    </section>
  </main>
</Base>

<script>
  import { initNoiseShader } from '@components/animations/NoiseShader';
  import { initBootSequence } from '@components/coming-soon/BootSequence';
  import { initQueryInterface } from '@components/coming-soon/QueryInterface';

  const canvas = document.querySelector<HTMLCanvasElement>('#noise-canvas');
  const bootEl = document.querySelector<HTMLElement>('#boot-sequence');
  const outputEl = document.querySelector<HTMLElement>('#query-output');
  const shellEl = document.querySelector<HTMLElement>('#query-shell');
  const inputEl = document.querySelector<HTMLInputElement>('#query-input');

  if (canvas && bootEl && outputEl && shellEl && inputEl) {
    initNoiseShader(canvas);
    const isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile) inputEl.placeholder = "ENTER COMMAND OR 'CATALOG'";

    initBootSequence(bootEl).then((boot) => {
      initQueryInterface({ output: outputEl, form: shellEl, input: inputEl }, boot);

      document.querySelectorAll<HTMLElement>('[data-glitchable="1"]').forEach((line) => {
        line.addEventListener('mouseenter', () => {
          line.classList.add('glitch-hover');
          window.setTimeout(() => line.classList.remove('glitch-hover'), 160);
        });
      });
    });
  }
</script>
