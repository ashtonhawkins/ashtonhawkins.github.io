---
import PagefindSearch from "astro-pagefind/components/Search";

const { id = "pagefind-search", className = "" } = Astro.props as { id?: string; className?: string };
---

<PagefindSearch
  id={id}
  className={`pagefind-wrapper relative overflow-hidden rounded-2xl border border-border/60 bg-surface shadow-soft ${className}`}
  uiOptions={{
    showSubResults: false,
    showImages: false,
    translations: {
      placeholder: "Search writing and moreâ€¦"
    }
  }}
/>

<script>
  const root = document.getElementById("${id}");
  const syncSearch = (event) => {
    if (!root || typeof event?.detail !== "string") return;
    const input = root.querySelector('input[type="text"]');
    if (input) {
      input.value = event.detail;
      input.dispatchEvent(new Event("input", { bubbles: true }));
    }
  };

  window.addEventListener("pagefind:query", syncSearch);
  document.addEventListener("astro:before-swap", () => {
    window.removeEventListener("pagefind:query", syncSearch);
  });
</script>
